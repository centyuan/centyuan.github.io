

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/person_fluid.jpg">
  <link rel="icon" href="/img/person_fluid.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="hlyuan">
  <meta name="keywords" content="">
  
    <meta name="description" content="什么是MQ  AMQP：即Advanced Message Queuing Protocol，是一个应用层标准高级消息队列协议，提供统一消息服务。是应用层协议的一个开放标准，为面向消息的中间件设计。类似于一种FIFO先入先出队列 为啥要用MQ? &gt;1.高并发的流量削峰 &gt;2.应用解耦 &gt;3.处理异步任务 &gt;4.消息分发 常见MQ: RabbitMQ &gt;由erlang">
<meta property="og:type" content="article">
<meta property="og:title" content="RabbitMQ Note">
<meta property="og:url" content="https://centyuan.github.io/2023/11/20/%E4%B8%AD%E9%97%B4%E4%BB%B6/rabbitmq_note/index.html">
<meta property="og:site_name" content="centyuan Blog">
<meta property="og:description" content="什么是MQ  AMQP：即Advanced Message Queuing Protocol，是一个应用层标准高级消息队列协议，提供统一消息服务。是应用层协议的一个开放标准，为面向消息的中间件设计。类似于一种FIFO先入先出队列 为啥要用MQ? &gt;1.高并发的流量削峰 &gt;2.应用解耦 &gt;3.处理异步任务 &gt;4.消息分发 常见MQ: RabbitMQ &gt;由erlang">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pic3.zhimg.com/v2-c6404583156af22d90e35aa2ae66de86_b.jpg">
<meta property="article:published_time" content="2023-11-20T13:33:48.474Z">
<meta property="article:modified_time" content="2023-11-22T14:32:39.763Z">
<meta property="article:author" content="hlyuan">
<meta property="article:tag" content="RabbitMQ">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://pic3.zhimg.com/v2-c6404583156af22d90e35aa2ae66de86_b.jpg">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>RabbitMQ Note - centyuan Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"centyuan.github.io","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="centyuan Blog" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>centyuan</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/person_default.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="RabbitMQ Note"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-11-20 21:33" pubdate>
          2023年11月20日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          4.6k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          39 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">RabbitMQ Note</h1>
            
            
              <div class="markdown-body">
                
                <p><img src="https://pic3.zhimg.com/v2-c6404583156af22d90e35aa2ae66de86_b.jpg" srcset="/img/loading.gif" lazyload alt="RabbitMQ_note"></p>
<h4 id="什么是MQ">什么是MQ</h4>
<blockquote>
<p><strong>AMQP</strong>：即Advanced Message Queuing Protocol，是一个应用层标准高级消息队列协议，提供统一消息服务。是应用层协议的一个开放标准，为面向消息的中间件设计。类似于一种FIFO先入先出队列</p>
<p><strong>为啥要用MQ?</strong></p>
<div class="code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">1.高并发的流量削峰</span>
<span class="hljs-meta prompt_">&gt;</span><span class="language-bash">2.应用解耦</span>
<span class="hljs-meta prompt_">&gt;</span><span class="language-bash">3.处理异步任务</span>
<span class="hljs-meta prompt_">&gt;</span><span class="language-bash">4.消息分发</span></code></pre></div>
<p><strong>常见MQ:</strong></p>
<p><strong>RabbitMQ</strong></p>
<div class="code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">由erlang语言开发,性能较好,吞吐量到万级，MQ功能比较完备,消息投递和消费可靠,稳定易用支持多种语言</span></code></pre></div>
<p><strong>Kafka</strong></p>
<div class="code-wrapper"><pre><code class="hljs crmsh">&gt;大数据的杀手锏,性能卓越，吞吐量高，单机写入 TPS 约在百万条/秒，时效性 <span class="hljs-keyword">ms</span> <span class="hljs-title">级，可用性非常高；其次kafka</span>是分布式的</code></pre></div>
<p><strong>RocketMQ</strong></p>
<div class="code-wrapper"><pre><code class="hljs mipsasm">&gt;RocketMQ 出自阿里巴巴的开源产品，用 <span class="hljs-keyword">Java </span>语言实现</code></pre></div>
</blockquote>
<h4 id="名词解释">名词解释</h4>
<blockquote>
<p><strong>Broker</strong>: 接收和分发消息的应用，<code>RabbitMQ Server</code>就是<code>Message Broker</code></p>
<p><strong>Virtual host</strong>: 出于多租户和安全因素设计的，把AMQP的基本组件划分到一个虚拟的分组中，类似于网络中的<code>namespace</code>概念。当多个不同的用户使用同一个<code>RabbitMQ server</code>提供的服务时，可以划分出多个<code>vhost</code>，每个用户在自己的<code>vhost</code>创建<code>exchange/queue</code>等</p>
<p><strong>Connection</strong>: <code>publisher/consumer</code>和<code>broker</code>之间的TCP连接</p>
<p><strong>Channel</strong>: 如果每一次访问<code>RabbitMQ</code>都建立一个<code>Connection</code>，在消息量大的时候建立<code>TCP Connection</code>的开销将是巨大的，效率也低,<code>Channel</code>是在connection内部建立的逻辑连接，如果应用程序支持多线程，通常每个thread创建单独的channel进行通讯，<code>AMQP method</code>包含了<code>channel id</code>帮助客户端和<code>message broker</code>识别<code>channel</code>，所以<code>channel</code>之间是完全隔离的。Channel作为轻量级的Connection极大减少了操作系统建立TCP connection的开销</p>
<p><strong>Exchange</strong>: message到达broker的第一站，根据分发规则，匹配查询表中的<code>routing key</code>，分发消息到queue中去。</p>
<p>常用的类型有：<code>direct(point-to-point)</code>，<code>topic(publish-subscribe) and fanout(multicast)</code></p>
<p><strong>Queue</strong>: 消息投递到queue，等待consumer消费</p>
<p><strong>Binding</strong>: exchange和queue之间的虚拟连接，binding中可以包含routing key，Binding信息被保存到exchange中的查询表中，用于message的分发依据。</p>
</blockquote>
<h4 id="RabbitMQ-Exchange分类">RabbitMQ Exchange分类</h4>
<blockquote>
<p>常用的有direct,fanout,topic,headers</p>
<p><strong>direct:</strong></p>
<div class="code-wrapper"><pre><code class="hljs basic"><span class="hljs-number">1</span>:<span class="hljs-number">1</span>,binding <span class="hljs-keyword">key</span>和routing <span class="hljs-keyword">key</span>都是队列的名称</code></pre></div>
<p><strong>fanout:</strong></p>
<div class="code-wrapper"><pre><code class="hljs basic"><span class="hljs-number">1</span>:N,不需要处理Route <span class="hljs-keyword">key</span>,把消息路由到与该Exchange绑定Binding的所有Queue</code></pre></div>
<p><strong>topic:</strong></p>
<div class="code-wrapper"><pre><code class="hljs vbnet"><span class="hljs-symbol">N:</span><span class="hljs-number">1</span>,多个exchange路由到同一个queue,根据routing <span class="hljs-keyword">key</span>的模糊匹配</code></pre></div>
<p><strong>headers:</strong></p>
<div class="code-wrapper"><pre><code class="hljs gauss">不处理routing <span class="hljs-built_in">key</span>,根据发送的消息内容中的headers属性(及参数)与绑定时指定的键值对进行匹配</code></pre></div>
<p><code>direct Exchange:</code><br>
是RabbitMQ Broker的默认Exchange它有一个特别的属性对一些简单的应用来说是非常有用的，在使用这个类型的Exchange时,可以不必指定routing key的名字,在此类型下创建的Queue有一个默认的routing key,这个routing key一般同Queue同名。</p>
</blockquote>
<h4 id="RabbitMQ的工作模式">RabbitMQ的工作模式:</h4>
<h5 id="1-simple模式">1.simple模式</h5>
<blockquote>
<p>一对一,不需要指定exchange,使用默认的 direct exchange</p>
<p><code>producer -&gt; queue -&gt; consumer</code></p>
</blockquote>
<h5 id="2-worker模式">2.worker模式</h5>
<blockquote>
<p>使用默认的direct exchange,一对多</p>
<p><code>producer -&gt;queue -&gt; consumer1,consumer2,consumer3</code></p>
<p>有多个消费者,消息被均分给多个消费者处理,两种分发方式:<br>
(1.轮询分发:平均分配,必须采用自动应答autoAck<br>
(2.公平分发:能者多劳(需要修改配置:1.消息确认改为手动ack,2.预处理模式qos参数=1,为每次读取一条消息)</p>
<div class="code-wrapper"><pre><code class="hljs gcode">&gt;高并发情况下,默认会产生某一个消息被多个消费者共同使用,可以设置一个开关<span class="hljs-comment">(syncronize)</span> 保证一条消息只能被一个消费者使用</code></pre></div>
</blockquote>
<h5 id="3-发布订阅模式">3.发布订阅模式</h5>
<blockquote>
<p>使用fanout exchange,publish/subscribe,消息投递到每个绑定的queue中<br>
<code>producer -&gt; fanout exchange-&gt; queue1,queue2,queue3 -&gt; consumer1,consumer2,consumer3</code></p>
</blockquote>
<h5 id="4-routing路由模式">4.routing路由模式</h5>
<blockquote>
<p>使用direct exchange,发送消息时指定routing key,以此投递消息到指定queue<br>
<code>producer -&gt; direct  exchange -&gt; queue1,queue2,queue3 -&gt; consumer1,consumer2,consumer3</code></p>
</blockquote>
<h5 id="5-topic主题模式">5.topic主题模式</h5>
<blockquote>
<p>使用Topic exchange,发送消息时候指定routing key,根据routing key模式匹配,消息被投递到一个或多个队列中</p>
<div class="code-wrapper"><pre><code class="hljs makefile"><span class="hljs-comment">#:代表0,1,多个</span>
<span class="hljs-section">*:至少有一个</span></code></pre></div>
</blockquote>
<h5 id="6-RPC模式">6.RPC模式</h5>
<h4 id="RabbitMQ-消息确认机制ACK">RabbitMQ 消息确认机制ACK</h4>
<blockquote>
<p>1.生产者发送消息确认分为:Confirm消息确认(将信道设置成Confirm模式,成功失败都有返回)和Return(投递失败时才有返回)消息机制<br>
<strong>2.消费者采用ack模式:</strong></p>
<div class="code-wrapper"><pre><code class="hljs makefile"><span class="hljs-section">自动ACK: 消费者接收到消息后自动发送ACK给RabbitMQ</span>
<span class="hljs-section">手动ACK: 手动控制消费者接收到并成功消息后发送ACK给RabbitMQ</span></code></pre></div>
</blockquote>
<h4 id="持久化">持久化</h4>
<blockquote>
<p>设置了队列和消息持久化后：<code>当服务重启之后，消息仍然存在</code></p>
<p>只设置队列持久化，不设置消息持久化：<code>重启之后消息会丢失</code></p>
<p>只设置消息持久化，不设置队列持久化: <code>在服务重启后，队列会消失，从而依附于队列的消息也会丢失,毫无意义</code></p>
<div class="code-wrapper"><pre><code class="hljs makefile"><span class="hljs-section">&gt;exchange和queue:通过durable参数设置</span>
<span class="hljs-section">&gt;消息:通过properties = pika.BasicProperties(delivery_mode=2)设置</span></code></pre></div>
</blockquote>
<h4 id="预取值">预取值</h4>
<blockquote>
<p>消息的发送就是异步发送的，所以在channel上肯定不止只有一个消息，消费者的手动确认也是异步的，就存在一个未确认的消息缓冲区，因此希望能限制此缓冲区的大小，以避免缓冲区里面无限制的未确认消息问题</p>
<p><code>通过使用basic.gos，方法设置“预取计数”值来完成的</code></p>
<p>定义通道上允许的未确认消息的最大数量。一旦数量达到配置的数量，RabbitMQ将停止在通道上传递更多消息</p>
<p><strong>prefetch预取值可以用来限流</strong></p>
</blockquote>
<h4 id="死信队列">死信队列:</h4>
<blockquote>
<p>死信，就是无法被消费的消息,由于某些原因导致queue中的某些消息无法被消费,则将这些消息投递到<code>死信队列</code></p>
<p><strong>死信可能的原因</strong></p>
<div class="code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">1.消息TTL过期</span>
<span class="hljs-meta prompt_">&gt;</span><span class="language-bash">2.队列达到最大长度(队列满了，无法再添加数据到mq中)</span>
<span class="hljs-meta prompt_">&gt;</span><span class="language-bash">3.消息被拒绝</span></code></pre></div>
</blockquote>
<h4 id="消息丢失？">消息丢失？</h4>
<blockquote>
<p>从三个方面解决:</p>
<p>1.生产者确认机制</p>
<div class="code-wrapper"><pre><code class="hljs makefile"><span class="hljs-section">&gt;开启生产者确认机制Confirm:只要消息成功发送到交换机之后，RabbitMQ就会发送一个ack给生产者（即使消息没有Queue接收，也会发送ack）。如果消息没有成功发送到交换机，就会发送一条nack消息，提示发送失败</span>
<span class="hljs-section">&gt;事务机制:在一条消息发送之后会使发送端阻塞，等待RabbitMQ的回应，之后才能继续发送下一条消息。性能差</span>
</code></pre></div>
<p>2.消费者手动确认</p>
<p>3.持久化</p>
</blockquote>
<h4 id="延迟队列">延迟队列</h4>
<blockquote>
<p>存储对应的延迟消息，指当消息被发送以后，并不想让消费者立刻拿到消息，而是等待特定时间后，消费者才能拿到这个消息进行消费</p>
</blockquote>
<h4 id="消息重复消费怎么处理？">消息重复消费怎么处理？</h4>
<blockquote>
<p><strong>1.生产时消息重复</strong></p>
<p><strong>2.消费时消息重复</strong></p>
<p>由于网络波动，导致消息确认没有收到</p>
<p><strong>解决方法:</strong></p>
<div class="code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">发送消息时让每个消息携带一个全局的唯一ID，在消费消息时先判断消息是否已经被消费过，保证消息消费逻辑的幂等性</span></code></pre></div>
</blockquote>
<h4 id="Other">Other</h4>
<blockquote>
<div class="code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">exclusive:指示队列是否是排他性。如果一个队列被声明为排他队列，该队列仅对首次申明它的连接可见，并在连接断开时自动删除。</span>
1. 排他队列是基于连接可见的，同一连接的不同信道Channel是可以同时访问同一连接创建的排他队列；
  	2.“首次”，如果一个连接已经声明了一个排他队列，其他连接是不允许建立同名的排他队列的，这个与普通队列不同；
  	3. 即使该队列是持久化的，一旦连接关闭或者客户端退出，该排他队列都会被自动删除的，这种队列适用于一个客户端发送读取消息的应用场景。
<span class="hljs-meta prompt_">&gt;</span><span class="language-bash">autoDelete:是否自动删除。如果该队列没有任何订阅的消费者的话，该队列会被自动删除。这种队列适用于发布订阅方式创建的临时队列</span>
<span class="hljs-meta prompt_"></span>
<span class="hljs-meta prompt_">&gt;</span><span class="language-bash">mandatory:</span>
<span class="hljs-meta prompt_">&gt;</span><span class="language-bash">当消息无法找到对应的queue时</span>
<span class="hljs-meta prompt_">&gt;</span><span class="language-bash">mandatory ：<span class="hljs-literal">true</span> 返回消息给生产者</span>
<span class="hljs-meta prompt_">&gt;</span><span class="language-bash">mandatory: <span class="hljs-literal">false</span> 直接丢弃</span></code></pre></div>
<p><strong>rabbitmq内存磁盘监控</strong></p>
<div class="code-wrapper"><pre><code class="hljs routeros">&gt;内存使用超过配置的阈值,或磁盘剩余空间低于配置的阈值会警告,rabbitmq连接会被挂起
rabbitmqctl set_vm_memory_high_watermark.<span class="hljs-attribute">relative</span>=0.4-0.6
rabbitmqctl set_vm_memory_high_watermark.<span class="hljs-attribute">absolute</span>=2GB
rabbitmqctl set_disk_free_limit 100GB
&gt;内存换页,内存使用率达到一定值,将内存中数据转入磁盘中
<span class="hljs-attribute">vm_memory_high_watermark_paging_ratio</span>=0.7</code></pre></div>
</blockquote>
<h4 id="rabbitmq集群搭建">rabbitmq集群搭建</h4>
<blockquote>
<p>1.停止rabbitmq服务<br>
2.启动第一个节点<br>
sudo RABBITMQ_NODE_PORT=5672 RABBITMQ_NODENAME=rabbit-1 rabbit-server start &amp;<br>
3.启动第二个节点<br>
sudo RABBITMQ_NODE_PORT=5673 RABBITMQ_SERVER_START_ARGS=“-rabbitmq_management listener [{port,15673}]” RABBITMQ_NODENAME=rabbit-2 rabbitmq-server start &amp;<br>
4.修改rabbit-1为主节点<br>
sudo rabbitmqctl -n rabbit-1 stop_app  # 1.停止应用<br>
sudo rabbitmqctl -n rabbit-1 reset     # 2.重置,清除节点上的历史数据(否则无法加入节点)<br>
sudo rabbitmqctl -n rabbit-1 start_app # 3.启动应用<br>
5.修改rabbit-2为从节点<br>
sudo rabbitmqctl -n rabbit-2 stop_app<br>
sudo rabbitmqctl -n rabbit-2 reset<br>
sudo rabbitmqctl -n rabbit-2 join_cluster rabbit-1@主机名<br>
sudo rabbitmqctl -n rabbit-2 start_app<br>
6.验证集群状态<br>
sudo rabbitmqctl cluster_status -n rabbit-1</p>
</blockquote>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/" class="category-chain-item">中间件</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/RabbitMQ/" class="print-no-link">#RabbitMQ</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>RabbitMQ Note</div>
      <div>https://centyuan.github.io/2023/11/20/中间件/rabbitmq_note/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>hlyuan</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年11月20日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/11/22/Python%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/GIL(%E8%BF%9B%E7%A8%8B%E7%BA%BF%E7%A8%8B%E5%8D%8F%E7%A8%8B)/" title="GIL/进程线程协程切换">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">GIL/进程线程协程切换</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/11/19/Python%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%8F%8A%E5%BA%A6%E9%87%8F/" title="Python性能优化">
                        <span class="hidden-mobile">Python性能优化</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <div> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> <a href="https://gitee/centyuan" target="_blank" rel="nofollow noopener"><span>centyuan</span></a> <i class="iconfont icon-love"></i> <a href="https://centyuan.github.io" target="_blank" rel="nofollow noopener"><span>BLog</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
